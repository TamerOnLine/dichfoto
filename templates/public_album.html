{% extends 'layout.html' %}

{# إخفاء الهيدر لهذه الصفحة #}
{% block header_class %}hide{% endblock %}

{# 🔹 Preload للـ hero image بأكثر من حجم #}
{% if assets|length > 0 %}
  {% set hero = assets[0] %}
  {% set hero_480  = hero.webp_480  or hero.jpg_480  or hero.thumb %}
  {% set hero_960  = hero.webp_960  or hero.jpg_960  or hero.thumb %}
  {% set hero_1280 = hero.webp_1280 or hero.jpg_1280 or hero.url %}
  {% set hero_1920 = hero.webp_1920 or hero.jpg_1920 or hero.url %}
  {% block head %}
    <link rel="preload" as="image"
          imagesrcset="{{ hero_480 }} 480w, {{ hero_960 }} 960w, {{ hero_1280 }} 1280w, {{ hero_1920 }} 1920w"
          imagesizes="100vw">
  {% endblock %}
{% endif %}

{% block content %}

  {% if locked %}
    <section class="container">
      <p>This album is protected. Enter the password to continue.</p>
      <form action="/s/{{ share.slug }}/unlock" method="post" class="form-box">
        <label for="password">Password</label>
        <input id="password" type="password" name="password" required />
        <button class="btn" type="submit">Unlock</button>
      </form>
    </section>
  {% else %}

    {% if assets|length > 0 %}
      {% set hero = assets[0] %}
      {% set hero_480  = hero.webp_480  or hero.jpg_480  or hero.thumb %}
      {% set hero_960  = hero.webp_960  or hero.jpg_960  or hero.thumb %}
      {% set hero_1280 = hero.webp_1280 or hero.jpg_1280 or hero.url %}
      {% set hero_1920 = hero.webp_1920 or hero.jpg_1920 or hero.url %}

      <section id="hero" class="hero">
        <picture>
          {% if hero.avif_480 %}
          <source type="image/avif"
                  srcset="{{ hero.avif_480 }} 480w, {{ hero.avif_960 }} 960w, {{ hero.avif_1280 }} 1280w, {{ hero.avif_1920 }} 1920w"
                  sizes="100vw">
          {% endif %}

          {% if hero.webp_480 %}
          <source type="image/webp"
                  srcset="{{ hero.webp_480 }} 480w, {{ hero.webp_960 }} 960w, {{ hero.webp_1280 }} 1280w, {{ hero.webp_1920 }} 1920w"
                  sizes="100vw">
          {% endif %}

          <img class="hero-img"
               src="{{ hero_960 }}"
               srcset="{{ hero_480 }} 480w, {{ hero_960 }} 960w, {{ hero_1280 }} 1280w, {{ hero_1920 }} 1920w"
               sizes="100vw"
               width="{{ hero.width }}" height="{{ hero.height }}"
               alt="{{ album.title }}"
               fetchpriority="high" loading="eager" decoding="async"
               style="background-image:url('{{ hero.lqip }}'); 
                      background-size:cover; 
                      background-position:center; 
                      filter: blur(20px); 
                      transform: scale(1.1);">
        </picture>

        <div class="hero-actions">
          <a class="icon-btn" href="/s/{{ share.slug }}/download" title="Download all">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 3v12m0 0 4-4m-4 4-4-4M4 21h16"
                    stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </a>
          <button class="icon-btn" type="button" title="Like">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-.99-1.06
                       a5.5 5.5 0 1 0-7.78 7.78L12 21.35l8.77-8.96
                       a5.5 5.5 0 0 0 .07-7.78Z"
                    stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>

        <div class="hero-overlay">
          <h2 class="hero-title">{{ album.title }}</h2>
        </div>
      </section>
    {% endif %}

    <div class="container">
      <div class="toolbar">
        <a class="btn" href="/s/{{ share.slug }}/download">Download all as ZIP</a>
      </div>

      {% if assets|length == 0 %}
        <p>No files available.</p>
      {% else %}
        <!-- Justified gallery -->
        <div id="gallery" class="jg">
          {% for a in assets[1:] %}
            <a class="jg-item" href="{{ a.url }}" target="_blank" rel="noopener">
              <img src="{{ a.thumb }}" alt="{{ a.name }}" loading="lazy" decoding="async" />
            </a>
          {% endfor %}
        </div>
      {% endif %}
    </div>

  {% endif %}

  <script src="/static/justified.js" defer></script>
{% endblock %}
